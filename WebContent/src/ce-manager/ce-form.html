<!--
@license
Copyright 2018, Rodrigo Prestes Machado and Lauro Correa Junior

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

	http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="ce-form-localization.html">
<link rel="import" href="../ce-container/ce-icons.html">

<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../../bower_components/paper-autocomplete/paper-autocomplete.html">
<link rel="import" href="../../bower_components/datetime-picker/overlay-date-picker.html">
<link rel="import" href="../../bower_components/datetime-picker/overlay-time-picker.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">


<link rel="import" href="../../bower_components/vaadin-form-layout/vaadin-form-layout.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">

<dom-module id="ce-form" > 
	<template>
		<style>
			:host {
				display: block;
			}
			
			#production {
				margin-top: 24px;				
				display: block;
			    margin-left: auto;
			    margin-right: auto;
			    width: 80%;
			    padding: 10px;
    		}
    
			h3{
				display: inline-block;
			}
			.form-title {
				margin-bottom: 20px;	
				display: inline-block;	
			}
			
			paper-icon-button.giant {
				float: right;
			    width: 80px;
			    height: 80px;
			}
			
			paper-icon-button.medium {
			    width: 40px;
			    height: 40px;
			}
							
			paper-toggle-button.date-toggle {
			  /*  padding-left: calc(27% + 1em);*/
			    display:inline-flex;
			}
			
			#dialog{
				min-height: 400px;
				min-width: 300px;
			}
			
			.chip {
				margin: 0px auto;
				border-radius: 500px;
				background-color: #e0e0e0;
				width: 75%;
				white-space: nowrap;
				overflow: hidden;
			}
			.chip > span {
				color: #424242;
				margin-left: 5px;
				font-size: 15px;
				overflow: hidden;
				text-overflow: ellipsis;
			}
			.chip iron-icon {
				margin: 2px 0px;
				color: #cdcdcd;
				background-color: #a6a6a6;
				border-radius: 500px;
				cursor: pointer;
				width: 16px;
				height: 16px;
			}
			
			.user {				
				width: 100%;
				margin-bottom: 20px;
			}			
						
			.user iron-icon {
				border-radius: 500px;
				cursor: pointer;
				position: absolute;
				top: -25px;
				right: 5px;
				
			}

			
			_span.toggle-left-label {
			    position: absolute;
			    white-space:nowrap;
			    right: 7em; /* Based on a relatively safe render width of the toggle button */
			    /*right: 200%;*/ /* Depending on your use case, you might find percentages friendlier than ems */
			}
			
			paper-card#production{
				min-height: 650px;
			}
			
			@media (max-width: 750px) {
				.form-title {
					font-size: 25px;
				}
				
				paper-icon-button.giant {
				    width: 45px;
				    height: 45px;
				}
			}						
		</style>
	 	  			
		<paper-card id="production">				
			<div class="card-content"
				id="ce-form">
				
					<div >
						<h1 class="form-title">
							{{localize('newProduction')}}
						</h1>
						<paper-icon-button 
							on-tap="_submit" 
							class="giant" 
							icon="icons:save" >
						</paper-icon-button>
					</div>
									
					<paper-textarea
						name="objective" 
						id="objective" 
						colspan="2"								
						on-blur="_setInformation"
						label="{{localize('productionObjective')}}"
						value="{{ production.objective}}"
						error-message="{{localize('required')}}">
					</paper-textarea>
									
					
					<fieldset style="display: inline; line-height: 283%;">
						<legend>
							{{localize('dataTime')}}
							<iron-icon
								icon="help-outline"
								on-tap="_tapHelp"
								title="{{localize('helpDataTime')}}">
							</iron-icon>
						</legend>
						
						<overlay-date-picker 
							name="sdata" 
							id="sdata" 
							on-blur="_setInformation"
							date="{{sdate}}"
							no-overlap>
						</overlay-date-picker>
						
						<overlay-time-picker 
							name="stime"
							id="stime" 
							clamp="seconds" 
							time="{{stime}}"
							on-blur="_setInformation">
						</overlay-time-picker>
					</fieldset>
					
					<fieldset style=" display: inline;">
						<legend>
							{{localize('numberOfParticipation')}}
							<iron-icon
								icon="help-outline"
								on-tap="_tapHelp"
								title="{{localize('helpNumberOfParticipationInProduction')}}">
							</iron-icon>							
						</legend>
						<paper-input style=" display: inline-block;"
		        			name="minimumParticipationInProduction"
		        			id="minimumParticipationInProduction"
		        			on-blur="_setInformation"
							label="{{localize('minimumOfParticipation')}}" 
							type="number"
							value="{{production.minimumTickets}}"
							min="0" >
								<iron-icon
									slot="suffix"
									icon="help-outline"
									on-tap="_tapHelp"
									title="{{localize('helpMinimumParticipationInProduction')}}">
								</iron-icon>
						</paper-input>
						
						<paper-input style="display: inline-block;"
							name="limitOfParticipationInProduction"
							id="limitOfParticipationInProduction" 
							on-blur="_setInformation"
							label="{{localize('limitOfParticipation')}}" 
							type="number"
							min="0"
							value="{{ production.limitTickets }}">
								<iron-icon
									slot="suffix"
									icon="help-outline"
									on-tap="_tapHelp"
									title="{{localize('helpLimitOfParticipationInProduction')}}">
								</iron-icon>
						</paper-input>		
					</fieldset>			
					
					<!-- Para questï¿½es de acessibilidade aria-disabled falta estudar mais o comportamento -->							
					<paper-input
						name="productionTime" 
						id="productionTime" 
						aria-disabled="true" 
						on-blur="_setInformation"
						label="{{localize('productionTime')}}" 
						type="number"
						value="{{production.productionTime}}"
						error-message="{{localize('required')}}"
						min="0">
							<iron-icon
								on-tap="_tapHelp"
								slot="suffix"
								icon="help-outline"
								title="{{localize('helpProductionTime')}}">
							</iron-icon>
					</paper-input>						
				
					<label >					
					{{ localize('participatInProduction') }}
					{{ _convertResponse(production.participatInProduction) }}
						<paper-toggle-button style="margin-top: 30px;"
							name="participatInProduction" 
							id="participatInProduction" 
							class="date-toggle" 									
							on-change="_setInformation"
							label-position="left" 								
							checked="{{production.participatInProduction}}"> 
							<span class="toggle-left-label"></span>							
						</paper-toggle-button>
						<iron-icon
							on-tap="_tapHelp"
							icon="help-outline"
							title="{{localize('helpParticipatInProduction')}}">
						</iron-icon>
					</label>
				
					<div>
						<paper-autocomplete 
							name="paperSuggestPerson" 
							id="paperSuggestPerson"
							on-keyup="_searchPeople"
							label="{{localize('participants')}}"
							error-message="{{localize('required')}}"
							remote-source >	
								<iron-icon
									slot="suffix"
									on-tap="_tapHelp"
									icon="help-outline"
									title="{{localize('helpPaperSuggestPerson')}}">
								</iron-icon>
						</paper-autocomplete>	
						<template 
							is="dom-repeat" 
							items="{{ production.userProductionConfigurations }}">

							<paper-card class="user"
								id="[[ item.user.id ]]">	
								<div class=" card-content">
									<fieldset>
										<legend>[[ _returnIdentification(item.user) ]]</legend>
										<paper-input
											aria-disabled="true"
											on-blur="_setInformation"
											type="text"
											value="{{ item.url }}"
											always-float-label
											placeholder="URL material:">
											<iron-icon
												slot="suffix"
												name="clearParticipant"
												icon="clear"
												on-tap="_clearParticipant"
												alt="clear"
												title="clear">
											</iron-icon>											
										</paper-input>	
									</fieldset>
								</div>
							</paper-card>
						</template>
					</div>
					
					<div>
						<h3>
							<iron-icon
								icon="help-outline"
								on-tap="_tapHelp"
								title="{{localize('helpRubric')}}">
							</iron-icon>
							{{localize('rubrics')}}							
						</h3> 
						
						<paper-icon-button 
							on-tap="_openDialog"
							class="medium"
							icon="my-icons:edit" >
						</paper-icon-button>
						<hr>							
						
						<template
							is="dom-repeat"
							items="{{production.rubricProductionConfigurations}}">
							
							<paper-card id="{{ item.rubric.id }}">
								<div class="card-content">									
									<div class="buttons">
										<paper-icon-button 
											id="disconnectRubric"
											on-tap="_disconnectButton"
											class="medium"
											icon="my-icons:close" >
										</paper-icon-button>										
									</div>
									<!-- Fbn00M$zEl
									Fbn00M$zEl -->
									
									<paper-button on-tap="_openDialog">										
						        		<h4>{{ _cutText(item.rubric.objective) }}</h4>						        		
						        	</paper-button>
						        	
					        		<fieldset>
						        		<legend>{{localize('numberOfParticipation')}} 
						        			<iron-icon
												icon="help-outline"
												on-tap="_tapHelp"
												title="{{localize('helpNumberOfParticipation')}}">
											</iron-icon>
						        		</legend>
						        		<paper-input
						        			name="minimumOfParticipation"
						        			on-blur="_setInformactionRubric"
											label="{{localize('minimumOfParticipation')}}" 
											type="number"
											min="0"
											value="{{ item.minimumTickets }}">
												<iron-icon
													slot="suffix"
													icon="help-outline"
													on-tap="_tapHelp"
													title="{{localize('helpMinimumOfParticipation')}}">
												</iron-icon>
										</paper-input>
										
										<paper-input 
											name="limitOfParticipation"
											on-blur="_setInformactionRubric"
											label="{{localize('limitOfParticipation')}}" 
											type="number"
											min="0"
											value="{{ item.limitTickets}}">
												<iron-icon
													slot="suffix"
													icon="help-outline"
													on-tap="_tapHelp"
													title="{{localize('helpLimitOfParticipation')}}">
												</iron-icon>
										</paper-input>		
									</fieldset>				        		
					        	</div>							        	
					        </paper-card>
					    </template>		
						
						<paper-dialog id="confirm" 
					    	style="width:30%;" 
					    	auto-fit-on-attach 
					    	on-iron-overlay-closed="dismissDialog">								
								<p>{{localize("confirmExclusion")}}</p>
								<paper-button dialog-confirm>yes</paper-button>
	            				<paper-button dialog-dismiss>no</paper-button>								
						</paper-dialog>
						
						<paper-dialog id="dialog">
							<div class="buttons" >
								<paper-button 
									id="discardRubric"
									on-tap="_discardButton">										
										<iron-icon 
											icon="my-icons:delete-sweep">
										</iron-icon>
										{{localize('discardRubric')}}
								</paper-button>

								<paper-button 
									id="disconnectRubric"
									on-tap="_disconnectButton">										
										<iron-icon 
										icon="my-icons:close">
										</iron-icon>
										{{localize('disconnectRubric')}}
								</paper-button>

								<paper-button 
									id="saveButton"
									on-tap="_saveButton">										
										<iron-icon 
										icon="my-icons:done-all">
										</iron-icon>
										{{localize('saveButton')}}
								</paper-button>
																
							</div>
							
							<h2>{{localize('rubric')}}</h2>
																			
							<paper-autocomplete 										
								id="descriptionRubric"
								name="descriptionRubric"
								on-keyup="_searchRubric"
								label="{{localize('descriptionRubric')}}"								
								remote-source
								min-length="2">
										<iron-icon
											slot="suffix"
											icon="help-outline"
											on-tap="_tapHelp"
											title="{{localize('descriptionRubric')}}">
										</iron-icon>
							</paper-autocomplete>
							
							<paper-input
								on-keydown="_enterEvent" 
								id="evaluetion" 
								name="evaluetion"
								aria-disabled="false" 
								label="{{localize('descriptor')}}" 
								type="text" >
									<iron-icon
										slot="suffix"
										icon="help-outline"
										on-tap="_tapHelp"
										title="{{localize('helpAvaluetion')}}">
									</iron-icon>	
							</paper-input>
																						
							<template 
								is="dom-repeat" 
								items="{{descriptors}}">
							
								<div class="chip">									
									<iron-icon
										name="clearDescriptor"
										icon="clear"
										on-tap="_clearDescriptor">
									</iron-icon>
									
									<span>{{ item }}</span>
								</div>
							</template>
						</paper-dialog>
						
						<paper-dialog id="help" style="width:20%;">							
							<div class="buttons" >
								<paper-button dialog-dismiss>										
										<iron-icon 
											icon="close">
										</iron-icon>										
								</paper-button>																
							</div>
							<p></p>							
						</paper-dialog>
					
					</div>								
					
			</div>
		</paper-card> 
	</template> 
	
	<!-- Load the Realtime JavaScript library -->
  <script src="https://apis.google.com/js/api.js"></script>
  <!-- Load the utility library -->
  <script src="https://www.gstatic.com/realtime/realtime-client-utils.js"></script>
  <!-- Sound Editor JS code -->
  <script type="text/javascript" src="ce-form.js"></script>  
  	
</dom-module>